from flask import Flask, render_template, request, redirect, url_for, session, flash
from flask_sqlalchemy import SQLAlchemy
from datetime import datetime

app = Flask(__name__)
app.secret_key = "secret_key"
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///expiremed.db'
app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False

db = SQLAlchemy(app)

# -------------------- Models --------------------
class User(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    email = db.Column(db.String(150), unique=True, nullable=False)
    password = db.Column(db.String(150), nullable=False)

class Medicine(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    user_id = db.Column(db.Integer, db.ForeignKey('user.id'))
    name = db.Column(db.String(100))
    type = db.Column(db.String(50))
    dosage = db.Column(db.Float)
    dosage_unit = db.Column(db.String(20))
    count = db.Column(db.String(10))
    before_after_food = db.Column(db.String(20))
    expiry_date = db.Column(db.Date)
    status = db.Column(db.String(20), default="Pending")  # Taken, Pending, Not Taken

class AlternativeMedicine(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    medicine_name = db.Column(db.String(100))
    alternative = db.Column(db.String(200))

db.create_all()

# -------------------- Routes --------------------
@app.route('/')
def home():
    return render_template('index.html')

@app.route('/register', methods=['GET', 'POST'])
def register():
    if request.method == 'POST':
        email = request.form.get('email')
        password = request.form.get('password')
        if User.query.filter_by(email=email).first():
            flash("Email already exists!")
            return redirect(url_for('register'))
        new_user = User(email=email, password=password)
        db.session.add(new_user)
        db.session.commit()
        flash("Registered successfully! Login now.")
        return redirect(url_for('login'))
    return render_template('register.html')

@app.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'POST':
        email = request.form.get('email')
        password = request.form.get('password')
        user = User.query.filter_by(email=email, password=password).first()
        if user:
            session['user_id'] = user.id
            return redirect(url_for('dashboard'))
        else:
            flash("Invalid credentials!")
            return redirect(url_for('login'))
    return render_template('login.html')

@app.route('/logout')
def logout():
    session.pop('user_id', None)
    return redirect(url_for('home'))

@app.route('/dashboard')
def dashboard():
    if 'user_id' not in session:
        return redirect(url_for('login'))
    user = User.query.get(session['user_id'])
    medicines = Medicine.query.filter_by(user_id=user.id).all()
    return render_template('dashboard.html', user=user, medicines=medicines)

@app.route('/add_medicine', methods=['GET', 'POST'])
def add_medicine():
    if 'user_id' not in session:
        return redirect(url_for('login'))
    if request.method == 'POST':
        name = request.form.get('name')
        type = request.form.get('type')
        dosage = request.form.get('dosage')
        dosage_unit = request.form.get('dosage_unit')
        count = request.form.get('count')
        before_after_food = request.form.get('before_after_food')
        expiry_date = request.form.get('expiry_date')
        new_medicine = Medicine(
            user_id=session['user_id'],
            name=name,
            type=type,
            dosage=dosage,
            dosage_unit=dosage_unit,
            count=count,
            before_after_food=before_after_food,
            expiry_date=datetime.strptime(expiry_date, '%Y-%m-%d'),
            status="Pending"
        )
        db.session.add(new_medicine)
        db.session.commit()
        flash("Medicine added successfully!")
        return redirect(url_for('dashboard'))
    return render_template('add_medicine.html')

@app.route('/delete_medicine/<int:id>')
def delete_medicine(id):
    med = Medicine.query.get(id)
    db.session.delete(med)
    db.session.commit()
    flash("Deleted successfully!")
    return redirect(url_for('dashboard'))

@app.route('/mark_medicine/<int:id>/<status>')
def mark_medicine(id, status):
    med = Medicine.query.get(id)
    med.status = status
    db.session.commit()
    return redirect(url_for('dashboard'))

@app.route('/reminder')
def reminder():
    if 'user_id' not in session:
        return redirect(url_for('login'))
    medicines = Medicine.query.filter_by(user_id=session['user_id']).all()
    return render_template('reminder.html', medicines=medicines)

@app.route('/alternative_medicine')
def alternative_medicine():
    if 'user_id' not in session:
        return redirect(url_for('login'))
    medicines = Medicine.query.filter_by(user_id=session['user_id']).all()
    return render_template('alternative_medicine.html', medicines=medicines)

if __name__ == "__main__":
    app.run(debug=True)

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Medicine Tracker</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="container">
  <h1>Medicine Tracker</h1>
  <div class="boxes">
    <a href="{{ url_for('dashboard') }}" class="box">Track Medicine</a>
    <a href="{{ url_for('reminder') }}" class="box">Set Reminder</a>
    <a href="{{ url_for('alternative_medicine') }}" class="box">Find Alternative</a>
  </div>
  <div class="auth-buttons">
    <a href="{{ url_for('register') }}" class="btn">Register</a>
    <a href="{{ url_for('login') }}" class="btn">Login</a>
  </div>
</div>
</body>
</html>

register

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Register</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="form-container">
  <h2>Register</h2>
  <form method="POST">
    <input type="email" name="email" placeholder="Email" required>
    <input type="password" name="password" placeholder="Password" required>
    <button type="submit">Register</button>
  </form>
  <a href="{{ url_for('login') }}">Already have account? Login</a>
</div>
</body>
</html>

login


<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="form-container">
  <h2>Login</h2>
  <form method="POST">
    <input type="email" name="email" placeholder="Email" required>
    <input type="password" name="password" placeholder="Password" required>
    <button type="submit">Login</button>
  </form>
  <a href="{{ url_for('register') }}">Don't have an account? Register</a>
</div>
</body>
</html>

dash

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<nav>
  <a href="{{ url_for('add_medicine') }}">Add Medicine</a>
  <a href="{{ url_for('reminder') }}">Reminders</a>
  <a href="{{ url_for('alternative_medicine') }}">Alternative Medicine</a>
  <a href="{{ url_for('logout') }}">Logout</a>
</nav>
<h2>Welcome, {{ user.email }}</h2>

<table>
  <tr>
    <th>Name</th>
    <th>Type</th>
    <th>Dosage</th>
    <th>Count</th>
    <th>Before/After Food</th>
    <th>Expiry Date</th>
    <th>Status</th>
    <th>Actions</th>
  </tr>
  {% for med in medicines %}
  <tr>
    <td>{{ med.name }}</td>
    <td>{{ med.type }}</td>
    <td>{{ med.dosage }} {{ med.dosage_unit }}</td>
    <td>{{ med.count }}</td>
    <td>{{ med.before_after_food }}</td>
    <td>{{ med.expiry_date.strftime('%Y-%m-%d') }}</td>
    <td class="{% if med.status=='Taken' %}green{% elif med.status=='Pending' %}yellow{% else %}red{% endif %}">{{ med.status }}</td>
    <td>
      <a href="{{ url_for('mark_medicine', id=med.id, status='Taken') }}">Taken</a> |
      <a href="{{ url_for('mark_medicine', id=med.id, status='Pending') }}">Pending</a> |
      <a href="{{ url_for('mark_medicine', id=med.id, status='Not Taken') }}">Not Taken</a> |
      <a href="{{ url_for('delete_medicine', id=med.id) }}">Delete</a>
    </td>
  </tr>
  {% endfor %}
</table>
</body>
</html>

remainder

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reminders</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<nav>
  <a href="{{ url_for('dashboard') }}">Dashboard</a>
  <a href="{{ url_for('logout') }}">Logout</a>
</nav>
<h2>Medicine Reminders</h2>
<ul>
  {% for med in medicines %}
  <li class="{% if med.status=='Taken' %}green{% elif med.status=='Pending' %}yellow{% else %}red{% endif %}">
    {{ med.name }} - {{ med.dosage }} {{ med.dosage_unit }} - Status: {{ med.status }}
  </li>
  {% endfor %}
</ul>
</body>
</html>

add medicine

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Add Medicine</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<nav>
  <a href="{{ url_for('dashboard') }}">Dashboard</a>
  <a href="{{ url_for('logout') }}">Logout</a>
</nav>
<h2>Add Medicine</h2>
<form method="POST">
  <input type="text" name="name" placeholder="Medicine Name" required>
  <select name="type" required>
    <option>Tablet</option>
    <option>Syrup</option>
    <option>Ointment</option>
  </select>
  <input type="number" name="dosage" placeholder="Dosage" step="0.01" required>
  <select name="dosage_unit" required>
    <option>mg</option>
    <option>ml</option>
    <option>g</option>
  </select>
  <select name="count" required>
    <option>1</option>
    <option>2</option>
    <option>Half</option>
  </select>
  <select name="before_after_food" required>
    <option>Before Food</option>
    <option>After Food</option>
  </select>
  <input type="date" name="expiry_date" required>
  <button type="submit">Add Medicine</button>
</form>
</body>
</html>

alternative

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Alternative Medicines</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<nav>
  <a href="{{ url_for('dashboard') }}">Dashboard</a>
  <a href="{{ url_for('logout') }}">Logout</a>
</nav>
<h2>Alternative Medicines</h2>
<ul>
  {% for med in medicines %}
    <li>{{ med.name }} - Suggested Alternative: {{ med.name }}</li>
  {% endfor %}
</ul>
</body>
</html>

css

body {
  font-family: Arial, sans-serif;
  background: #f9f9f9;
  margin: 0;
  padding: 0;
}

.container {
  text-align: center;
  margin-top: 50px;
}

.boxes {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin: 30px 0;
}

.box {
  background: #4CAF50;
  color: white;
  padding: 30px;
  border-radius: 10px;
  text-decoration: none;
  font-size: 18px;
  transition: transform 0.3s, background 0.3s;
}

.box:hover {
  transform: scale(1.1);
  background: #45a049;
}

.auth-buttons a {
  display: inline-block;
  margin: 10px;
  padding: 10px 20px;
  background: #2196F3;
  color: white;
  text-decoration: none;
  border-radius: 5px;
  transition: background 0.3s;
}

.auth-buttons a:hover {
  background: #0b7dda;
}

form {
  max-width: 400px;
  margin: 50px auto;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

input, select, button {
  padding: 10px;
  font-size: 16px;
}

button {
  background: #4CAF50;
  color: white;
  border: none;
  cursor: pointer;
}

button:hover {
  background: #45a049;
}

table {
  width: 90%;
  margin: 20px auto;
  border-collapse: collapse;
}

table, th, td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: center;
}

th {
  background: #4CAF50;
  color: white;
}

.green {
  background: #8BC34A;
  color: white;
}

.yellow {
  background: #FFC107;
  color: black;
}

.red {
  background: #F44336;
  color: white;
}

